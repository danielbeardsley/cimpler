#!/usr/bin/env node

var childProcess = require('child_process'),
httpTrigger    = require('../lib/http-trigger'),
Git            = require('../lib/git'),
git            = new Git(),
build          = {},
args           = require('optimist')
   .demand(1)
   .usage("Usage: cimpler build [-b branch-name]")
   .options('branch', {
      alias: 'b',
      describe: 'Name of the branch to build (defaults to current)'
   })
   .options('port', {
      alias: 'p',
      describe: 'HTTP port of the cimpler server (defaults to value in config.js)'
   }).argv;

git.remote(function(remote, repoPath) {
   build.repo = remote || repoPath;
   getBranch();
});

function getBranch() {
   if (args.branch) {
      build.branch = args.branch;
      httpTrigger(build, args.port);
   } else {
      git.currentBranch(function(branch) {
         build.branch = branch;
         httpTrigger(build, args.port);
      });
   }
}

